<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous">
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Work Day Scheduler</title>
  </head>

  <body>
    <header class="jumbotron">
      <h1 class="display-3">Work Day Scheduler</h1>
      <p class="lead">A simple calendar app for scheduling your work day</p>
      <p id="currentDay" class="lead"></p>
    </header>
    <div class="container">
      <!-- Timeblocks go here -->
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script>
      // Wait until Dom has completed loading
      $(document).ready(function() {
        // Console log that document is loaded and ready
        console.log("document is loaded and ready");

      // Testing moment.js is working properly, and testing how to use properly
      // Console.log(moment().format('MMMM Do YYYY, h:mm:ss a'));
      //log current time and date at top of log
      console.log(moment().format('dddd') + moment().format("MMM Do"));   
      console.log(moment().calendar());  
      // console.log(moment().startOf('hour').fromNow());
      // console.log(moment().endOf('hour').fromNow());
      // console.log(parseInt(moment().startOf('hour').fromNow()));
      console.log(moment().format());
      // currentTime = moment().format();
      // console.log(nextHour);
      // console.log(parseInt(nextHour));
      


      // Linking element with id 'currentDay' with moment.js' updated current date
      let currentDay = $("#currentDay");
      // Make variable for desired moment.js data
      let currentDate = moment().format('dddd') + " " + moment().format("MMM Do");
      // Make variable to display desiredmoment.js data in desired element
      currentDay.text(currentDate);

      let container = $(".container");

      // Make function to create grid in ''.container'
      function createTimeBlocks() {
        // Console log start of function
        console.log("start of 'createTimeBlocks' function");
        // Make for loop to create rows and columns with bootstrap classes for main area
        for (i = 1; i <= 24; i++) {
          
          // In for loop:
          // Console log start of row
          console.log("---------");  
          console.log("start of 'row" + i + "'");
          
          // Create div with class ‘row’ and Id row[i]
          let timeBlock = $("<div>").addClass("row");
          timeBlock.attr("id", "row" + i);
          // Check to see timeBlocks are created
          console.log(timeBlock);

          // Create three columns of class col-md-2, col-md-8, col-md-2, and
          //desired id's (hour, text, save)
          let colHour = $("<div>").addClass("col-sm-2");
          colHour.attr("id", "hour" + i);
          console.log(colHour);
          
          let colText = $("<div>").addClass("col-sm-8");
          colText.attr("id", "text" + i);
          console.log(colText);
          
          let colSave= $("<div>").addClass("col-sm-2");
          colSave.attr("id", "save"+ i);
          console.log(colSave);
          
          // For colHour, append a p element with ”[i] + 'AM'”
          // Creating elements
          hourStamp = $("<p>").addClass("hour-stamp");
          hourStamp.attr("id", "hourStamp"+ i);
          let am = " AM";
          let pm = " PM";
          
          // Conditional statements that govern whether am or pm is displayed in the hourStamp
          if (i === 24) {
            $(hourStamp).text((i - 12) + am);
          }
          else if (i === 12) {
            $(hourStamp).text(i + pm);
          }
          else if (i > 12) {
            $(hourStamp).text((i - 12) + pm);
          }
          else {
            $(hourStamp).text(i + am);
          }
          // For colHour, append hourStamp
          $(colHour).append(hourStamp);
          console.log(hourStamp);

          // Use a variable to create a textarea
          textStamp = $("<textarea>");
          textStamp.addClass("textStamp");
          textStamp.attr("id", "textArea"+ i);
          // Setting textStamp to max width of column
          textStamp.css("width", "100%");
          // For colText, append a textarea
          $(colText).append(textStamp);
          console.log(textStamp);

          // For colSave, append a button with an appended p element with "Save"
          let saveButton = $("<button>").addClass("saveButton");
          saveButton.attr("id", "saveButton"+ i);
          console.log(saveButton);
          
          let saveStamp = $("<p>").addClass("saveStamp");
          saveStamp.attr("id", "saveStamp"+ i);
          saveStamp.text("Save");
          console.log(saveStamp);

          $(saveButton).append(saveStamp);
          $(colSave).append(saveButton);
          

          // Append columns to timeBlock rows
          $(timeBlock).append(colHour, colText, colSave);
          // Append timeBlock to .container
          $(container).append(timeBlock);

          // Setting variable 'hourStampNumb' to be an integer that is equal to the number
          //in the id of the current row's hourStamp
          hourStampNumb = parseInt($(hourStamp).attr('id').replace(/hourStamp/, ''));
          console.log("current row parsed as integer: ");
          console.log("hourStampNumb is " + hourStampNumb);

          // Set variable equal to each textStamp id #
          // let inputNumb = parseInt($(textStamp).attr('id').replace(/textArea/, ''));
          // console.log(inputNumb);
          // textContent = $("#textArea"+ inputNumb)
          
          
          
          // Check current time and set row textarea bg colors dynamically
          //based on future, current hour, and past
          function setRowColors() {
            // Console log start of function
            console.log("---");  
            console.log("start of 'setRowColors' function");

            // Set hourStamp color and padding
            $(hourStamp).css("background-color","gray");
            $(hourStamp).css("padding","10px");
            
            // Set saveStamp padding
            $(saveStamp).css("padding","8px");

            let currentTime = moment().format();
            let nextHour = currentTime.substr(currentTime.length - 5); 
            console.log("next hour is " + nextHour);
            console.log("next hour parsed as integer below: ");
            console.log(parseInt(nextHour));
           
            if (parseInt(nextHour) > hourStampNumb) {
              $(textStamp).css("background-color","blue");
            }
            else if (parseInt(nextHour) == hourStampNumb) {
              $(textStamp).css("background-color","green");
            }
            else {
              $(textStamp).css("background-color","gray");
            }    
            // Console log end of function
            console.log("end of 'setRowColors' function");  
           
          };
          // *Don’t forget to Call functions*  
          setRowColors();

          // Console log end of row
          console.log("end of 'row" + i + "'");
          };
           // Console log end of loop
          console.log("end of loop");

          // Make function to store textarea input on click for rows when blue button is clicked
        $(".saveButton").on("click", function (event) {
            //prevent initial submission
            event.preventDefault();
            // Console log start of 'storeText' function
            console.log("start of storeText onClick function");

            // Set variable equal to value of textarea
            // userInput = $(this.textStamp.val());
            userInput = $(this).closest('textarea').find('texStamp').val();
            // userInputString = $(JSON.stringify(userInput));
            console.log("User Input is '" + userInput + "'");
 
            inputHour = $(this.hourStamp);
            console.log(inputHour);
            // Locally Store input that is in current row's textarea
            localStorage.setItem(inputHour, JSON.stringify(userInput));
            console.log("storing entry...");
            
            alert(localStorage.getItem(inputHour) + " has been stored");

            // Console log end of 'storeText' function
            console.log("end of storeText onClick function");
        });

        // Console log end of function
        console.log("end of 'createTimeBlocks' function");
        console.log("---------");
      };
      

      // Make and call function to retrieve stored data on document ready
      function retrieveData() {
        localStorage.getItem(inputHour);
      };
      // retrieveData();




      // *Don’t forget to Call functions*      
      createTimeBlocks();


      });
    </script>
  </body>
</html>
